<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QRMA - Create Result</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>QRMA - Create Result</h1>

<label>Name:</label><input type="text" id="name"><br>
<label>Age:</label><input type="number" id="age"><br>
<label>Gender:</label><input type="text" id="gender"><br>
<label>Address:</label><input type="text" id="address"><br>
<label>Date:</label><input type="date" id="date"><br>
<label>Note:</label><input type="text" id="note"><br>

<h2>Categories</h2>
<div id="categories"></div>

<button onclick="seeResult()">See Result</button>
<button onclick="navigate('index.html')">Back</button>

<script src="js/app.js"></script>
<script>
async function loadCategories() {
  const response = await fetch('assets/QRMA.txt');
  const text = await response.text();
  const lines = text.split('\n');
  const container = document.getElementById('categories');
  lines.forEach(line => {
    if(line.startsWith('CATEGORY:')){
      const h3 = document.createElement('h3');
      h3.textContent = line.replace('CATEGORY: ','');
      container.appendChild(h3);
    } else if(line.trim() !== ''){
      const div = document.createElement('div');
      const radioHigh = `<input type="radio" name="${line}" value="HIGH"> HIGH `;
      const radioLow = `<input type="radio" name="${line}" value="LOW"> LOW `;
      div.innerHTML = `<b>${line}</b><br>${radioHigh}${radioLow}<br>`;
      container.appendChild(div);
    }
  });
}
loadCategories();

function seeResult() {
  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const gender = document.getElementById('gender').value;
  const address = document.getElementById('address').value;
  const date = document.getElementById('date').value;
  const note = document.getElementById('note').value;

  const items = {};
  document.querySelectorAll('#categories div').forEach(div => {
    const itemName = div.querySelector('b').textContent;
    const selected = div.querySelector('input[type="radio"]:checked');
    items[itemName] = selected ? selected.value : '';
  });

  const result = {name, age, gender, address, date, note, items};
  saveResult('history', result);
  localStorage.setItem('currentResult', JSON.stringify(result));
  navigate('result.html');
}
</script>
</body>
</html>